#!/bin/bash

# Remove orphaned packages
# Author: Jason Ajmo

if [[ $EUID -ne 0 ]]; then
	echo "This script must be run as root"
	exit 1
fi

orphan_packages=$(pacman -Qdtq)
count=$(($(echo $orphaned_packages | wc -l) - 1))
date=$(date +%Y-%m-%d\ %H:%M:%S)
log="/var/log/orphaned.log"

# If there is at least 1, remove them
if [ $count -eq 0 ]; then
	echo "[$date] Packages are clean" >> $log
	exit
else
	pacman -Rsn $orphan_packages
	echo "[$date] Cleaned $count packages" >> $log
fi
